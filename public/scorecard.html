<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>ForeCaddie - Scorecard</title>
	<link href="https://fonts.googleapis.com/css?family=Carter+One" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Bevan" rel="stylesheet">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="stylesheet" href="/styles.css"/>
	<link rel="stylesheet" href="/scorecard-styles.css"/>
	<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
</head>
<body>
	<header class="header">
			<h2 class="name">ForeCaddie</h2>
			<button align="right" id="logoutButton">Logout</button>
			<button align="right" id="backButton">Back</button>
	</header>
	<div id="everythingScore" class="container">
		<h1 id="subwelcome">Your Card</h1>
			<h2 class="basic">Flatirons GC</h2>
		<div class="container" id="scorecard-table">
			<table class="table" id="scorecard">
				<tr>
					<th>Hole</th>
					<td>1</td>
					<td>2</td>
					<td>3</td>
					<td>4</td>
					<td>5</td>
					<td>6</td>
					<td>7</td>
					<td>8</td>
					<td>9</td>
					<th>Out Total</th>
					<td>10</td>
					<td>11</td>
					<td>12</td>
					<td>13</td>
					<td>14</td>
					<td>15</td>
					<td>16</td>
					<td>17</td>
					<td>18</td>
					<th>In Total</th>
					<th>Round Total</th>
				</tr>
				<tr>
					<th>Par</th>
					<td id="par1">4</td>
					<td id="par2">4</td>
					<td id="par3">4</td>
					<td id="par4">3</td>
					<td id="par5">4</td>
					<td id="par6">4</td>
					<td id="par7">5</td>
					<td id="par8">3</td>
					<td id="par9">4</td>
					<th id="outTotalPar">35</th>
					<td id="par10">4</td>
					<td id="par11">3</td>
					<td id="par12">4</td>
					<td id="par13">4</td>
					<td id="par14">5</td>
					<td id="par15">3</td>
					<td id="par16">4</td>
					<td id="par17">4</td>
					<td id="par18">4</td>
					<th id="inTotalPar">35</th>
					<th id="roundTotalPar">70</th>
				</tr>
				<tr>
					<th>Score</th>
					<td>
						<input type="number" class="card" id="userScore1"/>
					</td>
					<td>
						<input type="number" class="card"  id="userScore2"/>
					</td>
					<td>
						<input type="number" class="card"  id="userScore3"/>
					</td>
					<td>
						<input type="number" class="card"  id="userScore4"/>
					</td>
					<td>
						<input type="number" class="card" id="userScore5"/>
					</td>
					<td>
						<input type="number" class="card"  id="userScore6"/>
					</td>
					<td>
						<input type="number" class="card" id="userScore7"/>
					</td>
					<td>
						<input type="number" class="card" id="userScore8"/>
					</td>
					<td>
						<input type="number" class="card" id="userScore9"/>
					</td>
					<td id="userOutTotal">
					</td>
					<td>
						<input type="number" class="card" id="userScore10"/>
					</td>
					<td>
						<input type="number" class="card" id="userScore11"/>
					</td>
					<td>
						<input type="number" class="card" id="userScore12"/>
					</td>
					<td>
						<input type="number" class="card" id="userScore13"/>
					</td>
					<td>
						<input type="number" class="card" id="userScore14"/>
					</td>
					<td>
						<input type="number" class="card" id="userScore15"/>
					</td>
					<td>
						<input type="number" class="card" id="userScore16"/>
					</td>
					<td>
						<input type="number" class="card" id="userScore17"/>
					</td>
					<td>
						<input type="number" class="card" id="userScore18"/>
					</td>
					<td id="userInTotal">
					</td>
					<td id="userRoundTotal">
					</td>
				</tr>
				<tr>
					<th>FIR</th>
					<td>
						<input class="card" id="userFir1"/>
					</td>
					<td>
						<input class="card" id="userFir2"/>
					</td>
					<td>
						<input class="card" id="userFir3"/>
					</td>
					<td>
						<input class="card" id="userFir4"/>
					</td>
					<td>
						<input class="card" id="userFir5"/>
					</td>
					<td>
						<input class="card" id="userFir6"/>
					</td>
					<td>
						<input class="card" id="userFir7"/>
					</td>
					<td>
						<input class="card" id="userFir8"/>
					</td>
					<td>
						<input class="card" id="userFir9"/>
					</td>
					<td id="userFirOutTotal"/>
					</td>
					<td>
						<input class="card" id="userFir10"/>
					</td>
					<td>
						<input class="card" id="userFir11"/>
					</td>
					<td>
						<input class="card" id="userFir12"/>
					</td>
					<td>
						<input class="card" id="userFir13"/>
					</td>
					<td>
						<input class="card" id="userFir14"/>
					</td>
					<td>
						<input class="card" id="userFir15"/>
					</td>
					<td>
						<input class="card" id="userFir16"/>
					</td>
					<td>
						<input class="card" id="userFir17"/>
					</td>
					<td>
						<input class="card" id="userFir18"/>
					</td>
					<td id="userFirInTotal"/>
					</td>
					<td id="userFirRoundTotal"/>
					</td>
				</tr>
				<tr>
					<th>GIR</th>
					<td>
						<input class="card" type="checkbox" id="userGir1"/>
					</td>
					<td>
						<input class="card" type="checkbox" id="userGir2"/>
					</td>
					<td>
						<input class="card" type="checkbox" id="userGir3"/>
					</td>
					<td>
						<input class="card" type="checkbox" id="userGir4"/>
					</td>
					<td>
						<input class="card" type="checkbox" id="userGir5"/>
					</td>
					<td>
						<input class="card" type="checkbox" id="userGir6"/>
					</td>
					<td>
						<input class="card" type="checkbox" id="userGir7"/>
					</td>
					<td>
						<input class="card" type="checkbox" id="userGir8"/>
					</td>
					<td>
						<input class="card" type="checkbox" id="userGir9"/>
					</td>
					<td id="userGirOutTotal"/>
					</td>
					<td>
						<input class="card" type="checkbox" id="userGir10"/>
					</td>
					<td>
						<input class="card" type="checkbox" id="userGir11"/>
					</td>
					<td>
						<input class="card" type="checkbox" id="userGir12"/>
					</td>
					<td>
						<input class="card" type="checkbox" id="userGir13"/>
					</td>
					<td>
						<input class="card" type="checkbox" id="userGir14"/>
					</td>
					<td>
						<input class="card" type="checkbox" id="userGir15"/>
					</td>
					<td>
						<input class="card" type="checkbox" id="userGir16"/>
					</td>
					<td>
						<input class="card" type="checkbox" id="userGir17"/>
					</td>
					<td>
						<input class="card" type="checkbox" id="userGir18"/>
					</td>
					<td id="userGirInTotal"/>
					</td>
					<td id="userGirRoundTotal"/>
					</td>
				</tr>
				<tr>
					<th>Putts</th>
					<td>
						<input type="number" class="card" id="userPutts1"/>
					</td>
					<td>
						<input type="number" class="card" id="userPutts2"/>
					</td>
					<td>
						<input type="number" class="card" id="userPutts3"/>
					</td>
					<td>
						<input type="number" class="card" id="userPutts4"/>
					</td>
					<td>
						<input type="number" class="card" id="userPutts5"/>
					</td>
					<td>
						<input type="number" class="card" id="userPutts6"/>
					</td>
					<td>
						<input type="number" class="card" id="userPutts7"/>
					</td>
					<td>
						<input type="number" class="card" id="userPutts8"/>
					</td>
					<td>
						<input type="number" class="card" id="userPutts9"/>
					</td>
					<td id="userPuttsOutTotal"/>
					</td>
					<td>
						<input type="number" class="card" id="userPutts10"/>
					</td>
					<td>
						<input type="number" class="card" id="userPutts11"/>
					</td>
					<td>
						<input type="number" class="card" id="userPutts12"/>
					</td>
					<td>
						<input type="number" class="card" id="userPutts13"/>
					</td>
					<td>
						<input type="number" class="card" id="userPutts14"/>
					</td>
					<td>
						<input type="number" class="card" id="userPutts15"/>
					</td>
					<td>
						<input type="number" class="card" id="userPutts16"/>
					</td>
					<td>
						<input type="number" class="card" id="userPutts17"/>
					</td>
					<td>
						<input type="number" class="card" id="userPutts18"/>
					</td>
					<td id="userPuttsInTotal">
					</td>
					<td id="userPuttsRoundTotal"/>
					</td>
				</tr>
			</table>					
		</div>
	</div>
	<div id="message"></div>
	<div id="cardkey" class="container">
		<h2 class="basic">Scoring Key</h2>
			<ul class="keystyle">
				<li class="cardLI">Score: Your score for that hole.</li>
				<li class="cardLI">FIR: Fairways in Regulation. If your drive finds the fairway enter "C" (center), otherwise note which side you missed to, "L" (left) or "R" (right). </li>
				<li class="cardLI">GIR: Greens in Regulation. Did you reach the green in 1 shot on a Par 3, 2 shots on a Par 4, or 3 shots on a Par 5? Check the box if so.</li>
				<li class="cardLI">Putts: The number of putts you took on that hole.</li>
			</ul>
	</div>
	<footer class="footer">
		<p>ForeRight! Productions</p>
	</footer>	
	<script>

//Logout Functionality
	function logOut(){
		$.post('/api/logout',
			function (data){
			window.location.href = "/index.html";
			}
		);
	}

//Back button functionality  
	function goBack(){
		window.location.href= "/home.html";
	}	


//Global sum 9 holes function
	function sumNine(arr){
		var nineTotal = 0;
		for(var i = 0; i < arr.length; i++){
			if(isNaN(parseInt(arr[i]))) {
				$("#message").html("Please enter numerical values only");
				break;
			} else { 
				nineTotal += parseInt(arr[i]);
			}
		} return nineTotal;
	}	

//Total User Stats Per Current Round
	function totalScore(){
		var userOutNine = [];
		var userInNine = [];
		var i;

		for(i = 1; i <= 9; i++) {
			userOutNine.push($('#userScore' + i).val() || 0);
		}

		$("#userOutTotal").html(sumNine(userOutNine));

		for(i = 10; i <= 18; i++) {
			userInNine.push($('#userScore' + i).val() || 0);
		}

		$("#userInTotal").html(sumNine(userInNine));

		//Sum both 9's to 18
		var userTotal18 = sumNine(userOutNine) + sumNine(userInNine);

		$("#userRoundTotal").html(userTotal18);

		console.log(userOutNine);


   		updateScore(userOutNine, userInNine);
	}

		function updateScore(userOutNine, userInNine){
			$.post('/api/score', 
					{
						userOutNine: JSON.stringify(userOutNine),
						userInNine: JSON.stringify(userInNine),
						gameId: getGameId()
					},
					function(response) {
						console.log(response);
					});		
	}
	
	function totalFairways(){
		var userOutFairways = [];   //Saves to database
		var userInFairways = [];	//Saves to database
		var outCount = 0;			//To display totals on card to user
		var inCount = 0;			//To display totals on card to user
		var i;
		//Get outward 9 fairway results from user input
		for(i = 1; i <= 9; i++) {
			userOutFairways.push($('#userFir' + i).val() || "");
		}	

		//Get inward 9 fairway results
		for(i = 10; i <= 18; i++){
			userInFairways.push($('#userFir' + i).val() || "" );
		}

		//Function to loop through and count fairways hit
		function countFir(arr, count){
			for(i = 0; i < arr.length; i++){
				if( arr[i] === "C" || arr[i] === "c") {
					count = count + 1;
				} 
			} return count;
		}	

		//Count fairways and display to page
		$("#userFirOutTotal").html(countFir(userOutFairways, outCount) + "/7");

		$("#userFirInTotal").html(countFir(userInFairways, inCount) + "/7");

		var totalFairwayCount = countFir(userOutFairways, outCount) + countFir(userInFairways, inCount);

		$("#userFirRoundTotal").html(totalFairwayCount + "/14");

		function updateFairways(userOutFairways, userInFairways){
		$.post('/api/fairways', 
				{
					userOutFairways: JSON.stringify(userOutFairways),
					userInFairways: JSON.stringify(userInFairways),
					gameId: getGameId()
				},
				function(response) {
					console.log(response);
				});		
		}

		updateFairways(userOutFairways, userInFairways);
	}

	function totalGreens(){
		var userOutGreens = [];
		var userInGreens = [];
		var outGreenCount = 0;
		var inGreenCount = 0;

		//Get outward girs
		for(i = 1; i <= 9; i++) {
			if($('#userGir' + i).is(":checked")){
				$('#userGir' + i).val(true);	
			} else {
				$('#userGir' + i).val(false);
			}	userOutGreens.push($('#userGir' + i).val());
		}

		
		//Get inward girs
		for(i = 10; i <= 18; i++) {
			if($('#userGir' + i).is(":checked")){
				$('#userGir' + i).val(true);
			} else {
				$('#userGir' + i).val(false);
			}	userInGreens.push($('#userGir' + i).val());
		}

		//Function to loop through and count greens hit
		function countGir(arr, count){
			for(i = 0; i < arr.length; i++){
				if( arr[i] === "true" ){
					count = count + 1;
				} 
			} return count;
		}


		//Count greens and display to page
		$("#userGirOutTotal").html(countGir(userOutGreens, outGreenCount) + "/9");

		$("#userGirInTotal").html(countGir(userInGreens, inGreenCount) + "/9");

		var totalGreensCount = countGir(userOutGreens, outGreenCount) + countGir(userInGreens, inGreenCount);

		$("#userGirRoundTotal").html(totalGreensCount + "/18");

		function updateGreens(userOutGreens, userInGreens){
		$.post('/api/greens', 
				{
					userOutGreens: JSON.stringify(userOutGreens),
					userInGreens: JSON.stringify(userInGreens),
					gameId: getGameId()
				},
				function(response) {
					console.log(response);
				});		
	}

		updateGreens(userOutGreens, userInGreens);
	}


	function totalPutts(){
		var userOutPutts = [];
		var userInPutts = [];
		var i;

		for(i = 1; i <= 9; i++) {
			userOutPutts.push($('#userPutts' + i).val() || 0);
		}

		$('#userPuttsOutTotal').html(sumNine(userOutPutts));

		for(i = 10; i <= 18; i++) {
			userInPutts.push($('#userPutts' + i).val() || 0);
		}

		$('#userPuttsInTotal').html(sumNine(userInPutts));

		var userTotalPutts18 = sumNine(userOutPutts) + sumNine(userInPutts);

		$("#userPuttsRoundTotal").html(userTotalPutts18);

		function updatePutts(userOutPutts, userInPutts){
		$.post('/api/putts', 
				{
					userOutPutts: JSON.stringify(userOutPutts),
					userInPutts : JSON.stringify(userInPutts),
					gameId: getGameId()
				},
				function(response) {
					console.log(response);
				});		
		}

		updatePutts(userOutPutts, userInPutts);
	}

	function getGameId(){
		var url = document.location.href;
		return url.split('/').slice(-1)[0];
	}

	$(document).ready(function() {
		$('#logoutButton').click(logOut);
		$('#backButton').click(goBack);
		$('.card').blur(totalScore);
		$('.card').blur(totalFairways);
		$('.card').blur(totalGreens);
		$('.card').blur(totalPutts);
	});


	</script>
</body>
</html>